<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> - Admin Paneli</title>
    <link rel="stylesheet" href="../assets/css/admin_panel.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <img src="../assets/images/Esucodes-logo-transparent.png" alt=" Logo" class="logo">
        </div>
        <nav class="sidebar-nav">
            <ul>
                <li class="active">
                    <a href="#dashboard"><i class="fas fa-chart-line"></i> Dashboard</a>
                </li>
                <li>
                    <a href="#denetciler"><i class="fas fa-users"></i> Denetçiler</a>
                </li>
                <li>
                    <a href="#denetimler"><i class="fas fa-tasks"></i> Denetimler</a>
                </li>
                <li>
                    <a href="#raporlar"><i class="fas fa-file-alt"></i> Raporlar</a>
                </li>
                <li>
                    <a href="#loglar"><i class="fas fa-history"></i> Log Kayıtları</a>
                </li>
                <li>
                    <a href="Anasayfa.html" id="cikisBtn"><i class="fas fa-sign-out-alt"></i> Anasayfaya Dön</a>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Ana İçerik -->
    <main class="main-content">
        <header class="top-header">
            <div class="header-search">
                <input type="text" placeholder="Ara...">
                <i class="fas fa-search"></i>
            </div>
            <div class="header-right">
                <div class="notifications">
                    <i class="fas fa-bell"></i>
                    <span class="badge">3</span>
                </div>
                <div class="admin-profile">
                    <img src="../assets/images/admin-avatar.png" alt="Admin" class="avatar">
                    <div class="admin-info">
                        <span class="admin-name">Admin User</span>
                        <span class="admin-role">Super Admin</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Yeni Denetçi Modal -->
        <div id="yeniKullaniciModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Yeni Denetçi Ekle</h2>
                <form id="yeniKullaniciForm">
                    <div class="form-group">
                        <label for="ad">Ad:</label>
                        <input type="text" id="ad" name="ad" required>
                    </div>
                    <div class="form-group">
                        <label for="soyad">Soyad:</label>
                        <input type="text" id="soyad" name="soyad" required>
                    </div>
                    <div class="form-group">
                        <label for="email">E-posta:</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="sifre">Şifre:</label>
                        <input type="password" id="sifre" name="sifre" required>
                    </div>
                    <button type="submit" class="btn-primary">Denetçi Ekle</button>
                </form>
            </div>
        </div>

        <!-- Denetçiler Sekmesi -->
        <div id="denetciler" class="content-section" style="display: none;">
            <div class="section-header">
                <h2>Denetçiler</h2>
                <button class="btn-primary" id="yeniDenetciBtn">
                    <i class="fas fa-user-plus"></i> Yeni Denetçi
                </button>
            </div>
            <div class="denetciler-grid">
                <!-- Örnek denetçi kartları -->
                <div class="denetci-card">
                    <div class="denetci-info">
                        <img src="../assets/images/admin-avatar.png" alt="Denetçi" class="denetci-avatar">
                        <div class="denetci-details">
                            <h3>Ahmet Yılmaz</h3>
                            <p>Denetçi ID: DNT001</p>
                            <p>ahmet.yilmaz@example.com</p>
                        </div>
                    </div>
                    <div class="denetci-stats">
                        <div class="stat">
                            <span class="stat-label">Toplam Denetim</span>
                            <span class="stat-value">24</span>
                        </div>
                        <div class="stat">
                            <span class="stat-label">Aktif Denetim</span>
                            <span class="stat-value">3</span>
                        </div>
                    </div>
                </div>
                <!-- Diğer denetçi kartları buraya eklenecek -->
            </div>
        </div>

        <!-- Denetimler Sekmesi -->
        <div id="denetimler" class="content-section" style="display: none;">
            <div class="section-header">
                <h2>Denetimler</h2>
            </div>
            <div class="denetimler-grid">
                <!-- Örnek denetim kartı -->
                <div class="denetim-card">
                    <div class="denetim-header">
                        <h3>Web Uygulama Güvenlik Denetimi</h3>
                        <span class="denetim-durum aktif">Devam Ediyor</span>
                    </div>
                    <div class="denetim-detay">
                        <div class="detay-item">
                            <span class="detay-label">Denetlenen Kurum:</span>
                            <span class="detay-value">ABC Teknoloji A.Ş.</span>
                        </div>
                        <div class="detay-item">
                            <span class="detay-label">Denetçi:</span>
                            <span class="detay-value">Ahmet Yılmaz</span>
                        </div>
                        <div class="detay-item">
                            <span class="detay-label">Başlangıç:</span>
                            <span class="detay-value">15.03.2024</span>
                        </div>
                    </div>
                    <div class="denetim-actions">
                        <button class="btn-secondary">
                            <i class="fas fa-eye"></i> Detaylar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Raporlar Sekmesi -->
        <div id="raporlar" class="content-section" style="display: none;">
            <div class="section-header">
                <h2>Raporlar</h2>
            </div>
            <div class="raporlar-grid">
                <!-- Örnek rapor kartı -->
                <div class="rapor-card">
                    <div class="rapor-header">
                        <h3>Web Uygulama Güvenlik Denetimi</h3>
                        <span class="rapor-tarih">15.03.2024</span>
                    </div>
                    <div class="rapor-detay">
                        <div class="detay-item">
                            <span class="detay-label">Denetlenen Kurum:</span>
                            <span class="detay-value">ABC Teknoloji A.Ş.</span>
                        </div>
                        <div class="detay-item">
                            <span class="detay-label">Kurum ID:</span>
                            <span class="detay-value">KRM001</span>
                        </div>
                        <div class="detay-item">
                            <span class="detay-label">Denetçi:</span>
                            <span class="detay-value">Ahmet Yılmaz</span>
                        </div>
                        <div class="detay-item">
                            <span class="detay-label">Denetçi ID:</span>
                            <span class="detay-value">DNT001</span>
                        </div>
                    </div>
                    <div class="rapor-actions">
                        <button class="btn-secondary">
                            <i class="fas fa-download"></i> İndir
                        </button>
                        <button class="btn-secondary">
                            <i class="fas fa-eye"></i> Görüntüle
                        </button>
                    </div>
                </div>
                <!-- Diğer rapor kartları buraya eklenecek -->
            </div>
        </div>

        <!-- Log Kayıtları Sekmesi -->
        <div id="loglar" class="content-section" style="display: none;">
            <div class="section-header">
                <h2>Log Kayıtları</h2>
            </div>
            <div class="loglar-table">
                <table>
                    <thead>
                        <tr>
                            <th>Tarih</th>
                            <th>Kullanıcı</th>
                            <th>İşlem</th>
                            <th>Detay</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>15.03.2024 14:30</td>
                            <td>Ahmet Yılmaz</td>
                            <td>Giriş Yapıldı</td>
                            <td>Admin paneli</td>
                        </tr>
                        <tr>
                            <td>15.03.2024 14:35</td>
                            <td>Ahmet Yılmaz</td>
                            <td>Denetçi Eklendi</td>
                            <td>Mehmet Demir (DNT025)</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Dashboard -->
        <div class="dashboard-content">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-tasks"></i>
                    </div>
                    <div class="stat-info">
                        <h3>Devam Eden Denetim</h3>
                        <p class="stat-number">18</p>
                        <span class="stat-change neutral">-3 geçen aya göre</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-info">
                        <h3>Tamamlanan Denetim</h3>
                        <p class="stat-number">342</p>
                        <span class="stat-change positive">+28 bu ay</span>
                    </div>
                </div>
            </div>

            <div class="recent-activity">
                <h3>Son Aktiviteler</h3>
                <div class="activity-list">
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="activity-details">
                            <div class="activity-header">
                                <h4>Yeni Denetim Raporu Yüklendi</h4>
                                <span class="activity-time">15.03.2024 - 14:30</span>
                            </div>
                            <p class="activity-description">Web Uygulama Güvenlik Denetimi raporu sisteme yüklendi</p>
                            <div class="activity-meta">
                                <span class="activity-user">
                                    <i class="fas fa-user"></i> Ahmet Yılmaz
                                </span>
                                <span class="activity-target">
                                    <i class="fas fa-building"></i> ABC Teknoloji A.Ş.
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <div class="activity-details">
                            <div class="activity-header">
                                <h4>Yeni Denetçi Eklendi</h4>
                                <span class="activity-time">15.03.2024 - 11:15</span>
                            </div>
                            <p class="activity-description">Sisteme yeni denetçi kaydı oluşturuldu</p>
                            <div class="activity-meta">
                                <span class="activity-user">
                                    <i class="fas fa-user"></i> Mehmet Demir
                                </span>
                                <span class="activity-target">
                                    <i class="fas fa-id-card"></i> Denetçi ID: DNT025
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-edit"></i>
                        </div>
                        <div class="activity-details">
                            <div class="activity-header">
                                <h4>Denetim Güncellendi</h4>
                                <span class="activity-time">14.03.2024 - 16:45</span>
                            </div>
                            <p class="activity-description">Mobil Uygulama Güvenlik Denetimi güncellendi</p>
                            <div class="activity-meta">
                                <span class="activity-user">
                                    <i class="fas fa-user"></i> Ayşe Kaya
                                </span>
                                <span class="activity-target">
                                    <i class="fas fa-building"></i> XYZ Yazılım Ltd.
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get all navigation links and content sections
            const navLinks = document.querySelectorAll('.sidebar-nav a');
            const contentSections = document.querySelectorAll('.content-section');
            const dashboardContent = document.querySelector('.dashboard-content');

            // Function to show a specific section and hide others
            function showSection(sectionId) {
                // Hide all content sections
                contentSections.forEach(section => {
                    section.style.display = 'none';
                });
                if (dashboardContent) {
                    dashboardContent.style.display = 'none';
                }

                // Show the selected section
                if (sectionId === 'dashboard') {
                    if (dashboardContent) {
                        dashboardContent.style.display = 'block';
                    }
                } else {
                    const selectedSection = document.getElementById(sectionId);
                    if (selectedSection) {
                        selectedSection.style.display = 'block';
                    }
                }

                // Update active state in navigation
                navLinks.forEach(link => {
                    const parent = link.parentElement;
                    if (link.getAttribute('href') === `#${sectionId}`) {
                        parent.classList.add('active');
                    } else {
                        parent.classList.remove('active');
                    }
                });
            }

            // Add click event listeners to navigation links
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    // Eğer Anasayfaya Dön butonuna tıklandıysa gerçek yönlendirme yap
                    if (this.id === 'cikisBtn') {
                        window.location.href = 'Anasayfa.html';
                        return;
                    }
                    e.preventDefault();
                    const sectionId = this.getAttribute('href').substring(1);
                    if (sectionId !== 'Anasayfa') {
                        showSection(sectionId);
                    }
                });
            });

            // Show dashboard by default
            showSection('dashboard');

            // Handle new denetçi button click
            const yeniDenetciBtn = document.getElementById('yeniDenetciBtn');
            const modal = document.getElementById('yeniKullaniciModal');
            const closeBtn = document.querySelector('.close');
            const form = document.getElementById('yeniKullaniciForm');

            if (yeniDenetciBtn && modal) {
                yeniDenetciBtn.addEventListener('click', function() {
                    modal.style.display = 'block';
                });
            }

            if (closeBtn && modal) {
                closeBtn.addEventListener('click', function() {
                    modal.style.display = 'none';
                });
            }

            // Close modal when clicking outside
            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            }

            if (form) {
                form.onsubmit = async function(e) {
                    e.preventDefault();
                    
                    const formData = {
                        name: document.getElementById('ad').value,
                        surname: document.getElementById('soyad').value,
                        email: document.getElementById('email').value,
                        password: document.getElementById('sifre').value,
                        username: document.getElementById('email').value.split('@')[0], // E-posta adresinden kullanıcı adı oluştur
                        role: 'user' // Varsayılan olarak normal kullanıcı rolü
                    };

                    try {
                        const response = await fetch('/api/users', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${localStorage.getItem('token')}`
                            },
                            body: JSON.stringify(formData)
                        });

                        if (response.ok) {
                            form.reset();
                            modal.style.display = 'none';
                            alert('Kullanıcı başarıyla eklendi!');
                            // Sayfayı yenile
                            location.reload();
                        } else {
                            const error = await response.json();
                            alert(`Hata: ${error.message}`);
                        }
                    } catch (error) {
                        console.error('Hata:', error);
                        alert('Kullanıcı eklenirken bir hata oluştu!');
                    }
                };
            }
        });
    </script>
</body>
</html> 
